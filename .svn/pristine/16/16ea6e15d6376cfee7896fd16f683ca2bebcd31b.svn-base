define(["jquery","core/templates","core/notification"],function(a,b,c){var d={PROGRAMS:".guide-channel li:not(.icon) a",POPUP:"program-popup",POPUPCONTENT:'[data-region="popup-content"]'},e={POPUP:"small-text"},f={POPUP:"local_mediaserver/popup"},g=null,h=200,i=function(e){var i=a(e.target),j=i.offset(),k=i.data("program");b.render(f.POPUP,k).then(function(a,c){b.replaceNode(g.find(d.POPUPCONTENT),a,c),g.css({left:j.left+10,top:j.top+16}),g.clearQueue().delay(h).fadeIn(h,function(){g.animate({scrollTop:0},h)})})["catch"](c.exception)},j=function(a){var b={left:a.pageX,top:a.pageY},c=g.offset();return b.left>=c.left&&b.left<=c.left+g.width()&&b.top>=c.top&&b.top<=c.top+g.height()?void a.preventDefault():void g.clearQueue().delay(h).fadeOut(h)};return{init:function(h){g=a("#"+d.POPUP),0===g.length&&b.render(f.POPUP,{}).then(function(c,f){b.runTemplateJS(f),g=a("<div />").attr({id:d.POPUP,hidden:"hidden"}).addClass(e.POPUP).append(c),g.on("mouseleave",j),a("body").append(g)})["catch"](c.exception),h=h||d.PROGRAMS,a(h).hover(i,j)}}});